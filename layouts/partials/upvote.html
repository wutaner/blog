{{ if and (eq .Site.Params.enableUpvote true) .Site.Params.githubToken .IsPage }}
<form class="upvote-form" style="display: inline"><small><input hidden name="uid" value="{{ .Page.RelPermalink }}"><button class="upvote-button" title="Upvote"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><polyline points="17 11 12 6 7 11"></polyline><polyline points="17 18 12 13 7 18"></polyline></svg><small class="upvote-count">0</small></button></small></form>

<style>
.upvote-button {
    padding: 0;
    margin: 0;
    border: 0;
    background-color: inherit;
    color: inherit;
    display: flex;
    flex-direction: column;
    align-items: center;
}
.upvote-button.upvoted {
    color: salmon;
}
.upvote-count {
    margin-top: -3px;
}
</style>

<script>
document.querySelector('.upvote-form').addEventListener('submit', (e) => {
    e.preventDefault();
    const form = e.target;
    const button = form.querySelector('button');
    const countElement = form.querySelector('.upvote-count');
    
    fetch('https://api.github.com/gists/{{ .Site.Params.gistId }}', {
        method: 'PATCH',
        headers: {
            'Authorization': 'token {{ .Site.Params.githubToken }}',
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            files: {
                'upvotes.json': {
                    content: JSON.stringify({
                        [form.querySelector('input[name="uid"]').value]: parseInt(countElement.innerHTML) + 1
                    })
                }
            }
        })
    }).then(r => {
        if (r.ok) {
            button.disabled = true;
            button.style.color = "salmon";
            countElement.innerHTML = parseInt(countElement.innerHTML) + 1;
        }
    }).catch(e => console.error('Upvote failed:', e));
});
</script>
{{ end }} 